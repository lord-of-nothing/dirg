name: CI for RISC-V simulator project

on: pull_request

jobs:
    setup:
        name: Setup project
        runs-on: ubuntu-24.04
        env:
            CC: gcc-14
            CXX: g++-14
        steps:
            - uses: actions/checkout@v3
            - run: |
                  sudo apt-get update
                  sudo apt-get install -y cmake ninja-build g++-14 libstdc++-14-dev
            - run: /bin/bash .ci/setup.sh
            - name: Cache cmake and third party
              uses: actions/upload-artifact@v2
              with:
                name: cmake_cache
                path: |
                  build
    format-check:
        needs: setup
        name: Check clang-format
        runs-on: ubuntu-24.04
        env:
            CC: gcc-14
            CXX: g++-14
        steps:
            - uses: actions/checkout@v3
            - name: Download artifact
              uses: actions/download-artifact@v2
              with:
                name: cmake_cache
            - run: |
                  sudo apt-get update
                  sudo apt-get install -y ninja-build clang-format
            - run: /bin/bash .ci/format_check.sh
    tidy-check:
        needs: setup
        name: Check clang-tidy
        runs-on: ubuntu-24.04
        env:
            CC: gcc-14
            CXX: g++-14
        steps:
            - uses: actions/checkout@v3
            - name: Download artifact
              uses: actions/download-artifact@v2
              with:
                name: cmake_cache
            - run: |
                  sudo apt-get update
                  sudo apt-get install -y ninja-build clang-tidy g++-14 libstdc++-14-dev
            - run: /bin/bash .ci/tidy_check.sh